// @codekit-append "lib/obj.js"
// @codekit-append "init.js"
// @codekit-append "preload.js"
// @codekit-append "random.js"
// @codekit-append "common.js"
// @codekit-append "archive.js"
// @codekit-append "slideshow.js"
// @codekit-append "grid.js"
// @codekit-append "drag.js"
// @codekit-append "page.js"
"use strict";
/*
 *  * object - �I�u�W�F�N�g����
 *  * Object object(BaseObj [, mixinObj1 [, mixinObj2...]])
 */
function object(e){var a=object.f,t,i,n,s;for(a.prototype=e,n=new a,t=1,i=arguments.length;t<i;++t)for(s in arguments[t])n[s]=arguments[t][s];return n}function getCurrentLang(){var e;"en"===location.pathname.split("/")[1]&&(currentLang="en")}object.f=function(){};var userAgent=window.navigator.userAgent.toLowerCase(),appVersion=window.navigator.appVersion.toLowerCase(),isLegacy=-1<appVersion.indexOf("msie 8.0")||-1<appVersion.indexOf("msie 9.0")||-1<appVersion.indexOf("msie 10.0"),isIE10=-1<appVersion.indexOf("msie 10.0"),isIE11=-1<navigator.userAgent.toLowerCase().indexOf("trident/7"),isIE8over=-1<appVersion.indexOf("msie 8.0")||-1<appVersion.indexOf("msie 9.0")||-1<appVersion.indexOf("msie 10.0")||-1<appVersion.indexOf("msie 11.0"),isIE=-1!==userAgent.indexOf("msie")||navigator.userAgent.match(/Trident/),isAndroid=navigator.userAgent.match(/Android/i),isIPhone=navigator.userAgent.match(/iPhone/i),isSP=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPhone/i),isIPad=navigator.userAgent.match(/iPad/i),isFF=-1!==userAgent.indexOf("firefox"),isEdge=-1<userAgent.indexOf("applewebkit")&&-1<userAgent.indexOf("edge"),isMobile=!0,isSmallScreen=!1,isPC=!0;isPC=!(isAndroid||isIPhone||isIPad);var $html=document.documentElement;//win or mac
if(-1!==navigator.userAgent.indexOf("Win")&&(isFF?($html.classList.add("os_windows"),$html.classList.add("firefox")):isIE?isIE10?($html.classList.add("os_windows"),$html.classList.add("legacy")):isIE11&&($html.classList.add("os_windows"),$html.classList.add("ie11")):isEdge?($html.classList.add("os_windows"),$html.classList.add("edge")):$html.classList.add("os_windows")),-1!==navigator.userAgent.indexOf("Mac")){var cls="";isFF?($html.classList.add("os_mac"),$html.classList.add("firefox")):-1<userAgent.indexOf("safari")&&-1===userAgent.indexOf("chrome")?($html.classList.add("os_mac"),$html.classList.add("safari")):$html.classList.add("os_mac")}var load={getJson:function e(a,t){var i=$.Deferred(),a=a;return $.ajax({type:"GET",dataType:"json",url:a,data:t,success:i.resolve,error:i.reject}),i.promise()},postJson:function e(a,t){var i=$.Deferred(),a=a;return $.ajax({type:"POST",dataType:"json",url:a,data:t,success:i.resolve,error:i.reject}),i.promise()}},param={next:"",y:[],c:[],t:[]},search={param:"",y:[],cat:[],tag:[],makeArryUnique:function e(){search.y=search.y.filter(function(e,a,t){return t.indexOf(e)===a}),search.cat=search.cat.filter(function(e,a,t){return t.indexOf(e)===a}),search.tag=search.tag.filter(function(e,a,t){return t.indexOf(e)===a})},changeURL:function e(){search.makeArryUnique();//console.log("changeURL:",search.y, search.cat, search.tag);
var a="",t=!0;if(0!=search.y.length&&(a+=-1==a.indexOf("?")?"?":"&",a+="y="+search.y,t=!1),0!=search.cat.length){for(var i=0;i<search.cat.length;i++)a+=-1==a.indexOf("?")?"?":"&",a+="c[]="+search.cat[i];t=!1}if(0!=search.tag.length){for(var n=0;n<search.tag.length;n++)a+=-1==a.indexOf("?")?"?":"&",a+="t[]="+search.tag[n];t=!1}var s="/";if("en"===currentLang)var s="/en/";a=t?s:s+a,search.checkActive(),search.param=a,window.history.pushState(null,null,a),page.checkUrl()},checkActive:function e(){if(search.makeArryUnique(),0!=search.y.length)for(var a=0;a<search.y.length;a++)$("[data-name="+search.y[a]+"]").each(function(e){$(this).addClass("active")});if(0!=search.cat.length)for(var t=0;t<search.cat.length;t++)$("[data-name="+search.cat[t]+"]").each(function(e){$(this).addClass("active")});if(0!=search.tag.length)for(var i=0;i<search.tag.length;i++)$("[data-name="+search.tag[i]+"]").each(function(e){$(this).addClass("active")})}},currentLang="jp";getCurrentLang();
/*
HOW TO
MAKE IMAGE ARRAY AND PASS TO preload.startLoad
------------------------------------------------
var imgarry = [];
for(var i = 0; i < 100; i++){
	imgarry.push("images/test/bg" + i + ".png");
}
preload.startLoad(100,imgarry).done(function(){
	console.log("all done")
});
*/
var preload={count:0,max:0,arry:[],startLoad:function e(a,t){var i=$.Deferred(),n;return preload.count=0,this.max=a,this.arry=t,this.load().done(function(){i.resolve()}),i.promise()},load:function e(){function a(){var e=new Image;e.src=preload.arry[preload.count],e.onload=function(){preload.count++,preload.count<preload.max?a():t.resolve()}}var t=$.Deferred();return a(),t.promise()}},Rand={len:0,base:"",texts:[],run:function e(t){function i(){if(n<s.len){n++;for(var e="",a=0;a<n;a++)e+=randomText.texts[Math.floor(Math.random()*randomText.texts.length)];$(".r").eq(t).find("a span").html(e),setTimeout(function(){i()},22)}else $(".r").eq(t).find("a span").html(s.base)}var n=0,s=this;i()}},rands=[],randomText={texts:"abcdefghijklmnopqrstuvwxyz0123456789",init:function e(){rands=[],$(".r").each(function(){var e=object(Rand),a=$(this).text(),t=a.length;e.base=a,e.len=t,e.texts=[],rands.push(e)}),setTimeout(function(){$(".r").each(function(e){$(".r").eq(e).find("a span").html("");//rands[i].run(i);
})},100)}},Block={top:0,show:0,base:"",len:0,texts:[],run:function e(a){function t(){if(i<n.len){i++;for(var e="",a=0;a<i;a++)e+=randomText.texts[Math.floor(Math.random()*randomText.texts.length)];s.html(e),setTimeout(function(){t()},22)}else s.html(n.base),s.css("height","")}var i=0,n=this,s=$(".blk").eq(a).find("h3"),o=s.height();s.css("height",o+"px"),t()}},blocks=[],isPage="",common={fixPoint:0,backPoint:0,aim:0,currentPost:0,init:function e(){
/*
    $("body").css({
    	"cursor": "none"
    });
    */
var a;loopthumb.init();var t=null,i=$("body");common.nav(),common.resize();var n="/api/posts.json",s={};load.getJson(n,s).done(function(e){posts="jp"===currentLang?e.ja:e.en,page.init(),common.scrlAim()});
/* window resize
    ----------------------------- */
var o=function e(){common.resize(),t=null},r;$(document).on("scroll touchmove",function(){common.scrl(),clearTimeout(r),r=setTimeout(function(){function a(e){blocks[e].run(e),++e<t&&setTimeout(function(){a(e)},500)}var e=common.currentPost-2;e=e<0?0:e;var t=common.currentPost+2;t=t>blocks.length-1?blocks.length-1:t,a(e)},4e3)}),$(window).off("resize").on("resize",function(){i.hasClass("resize")||i.addClass("resize"),t&&clearTimeout(t),t=setTimeout(o,300)}),common.mouseCursor()},nav:function e(){var a=$("body");$("a#btn_menu").off().on("click",function(){a.hasClass("show_menu")?a.removeClass("show_menu"):a.addClass("show_menu")}),$("#nav_select li a").off().on("click",function(){var e,a="active"+$("#nav_select li a").index(this);$("#select_categories").removeClass(),$("#select_categories").addClass(a)}),$("#nav_select_detail li a").off().on("click",function(){var e,a="active"+$("#nav_select_detail li a").index(this);$("#post_detail nav.nav").removeClass(function(e,a){return(a.match(/\bactive\S+/g)||[]).join(" ")}),$("#post_detail nav.nav").addClass(a)})},resize:function e(){var a=window.innerWidth,t=window.innerHeight,i=$("body");common.fixPoint=$("#nav_category").outerHeight(),common.backPoint=$("section.posts").offset().top,window.matchMedia("all and (min-width : 864px)").matches?(isSmallScreen=!1,i.removeClass("show_menu")):window.matchMedia("all and (min-width : 0px)").matches&&(isSmallScreen=!0),$(".detail_inner").css("width",a+"px"),$("#block_about_inner").css("width",a+"px"),$("#loading_logo_inner").css("width",a+"px"),grid.checkHeight(),slideshow.change(),timeline.years=[];var n=0;$(".year").each(function(){var e=Math.floor($(this).offset().left);n+=$(this).width(),timeline.years.push(e)}),d.target&&d.resize(),$(".timeline_wrap").css("width",n),setTimeout(function(){common.checkBlock(),i.hasClass("resize")&&i.removeClass("resize")},300)},checkBlock:function e(){blocks=[],$(".blk").each(function(){var e=object(Block);e.top=Math.floor($(this).offset().top),e.show=Math.floor(e.top+$(window).height()/3),e.base=$(this).find("h3").text(),e.len=e.base.length,e.texts=[],blocks.push(e)})},scrollToPosition:function e(a){var t=$.Deferred(),i,n="easeInOutCubic",s=!0;return $("html,body").animate({scrollTop:a+"px"},{duration:1e3,easing:n,complete:function e(){t.resolve()}}),t.promise()},scrlAim:function e(){function i(){d.hasClass("show_category")||d.addClass("show_category")}function n(){d.hasClass("show_category")&&d.removeClass("show_category")}if(isSP||isIPad){var s=function e(a){return a.touches[0].pageY},a="ontouchstart"in window,t=60,o,r,c;$("body").off().on({touchstart:function e(a){c=0,o=s(a)},touchmove:function e(a){var t=event.touches[0].clientX;(c=o-s(event))<0?i():n()},touchend:function e(a){c<0?i():n(),c=0},touchcancel:function e(a){c=0}})}else{var l="onwheel"in document?"wheel":"onmousewheel"in document?"mousewheel":"DOMMouseScroll";$(document).on(l,function(e){var a=e.originalEvent.deltaY?-e.originalEvent.deltaY:e.originalEvent.wheelDelta?e.originalEvent.wheelDelta:-e.originalEvent.detail;$("body").hasClass("show_detail")?n():a<0?(n(),common.aim=0):20<a&&(i(),common.aim=1)})}var d=$("body")},scrl:function e(){function a(e){var a=$(".blk").eq(e);common.currentPost=e,a.hasClass("animate")||(a.addClass("animate"),//blocks[i].run(i);
setTimeout(function(){a.addClass("animated");//$(".blk").eq(i).find("h3").html(blocks[i].base);
},1e3))}var t=$(document).scrollTop(),i=t+$(window).height(),n=$("body"),s=$(document).height();//console.log(topD, common.fixPoint, common.aim)
if(t>=common.fixPoint)n.hasClass("fix")||n.addClass("fix"),$("#nav_category").css({transform:"translate3d(0, -100%, 0)"});else if(n.hasClass("fix")&&n.removeClass("fix"),!isSP){var o=Math.floor(t/common.fixPoint*-100);o<-100&&(o=-100),//console.log(per, common.fixPoint, topD)
1===common.aim?$("#nav_category").css({transform:"translate3d(0, 0%, 0)"}):$("#nav_category").css({transform:"translate3d(0, "+o+"%, 0)"})}// archive
s-100<=i&&archive.loadFlag&&(archive.loadFlag=!1,archive.inc());for(var r=blocks.length,c=0;c<r;c++)i>=blocks[c].show&&a(c)},mouseCursor:function e(){function a(e){var a=e.clientX,t=e.clientY;isSmallScreen?$("#icon_loading").css({transform:""}):$("#icon_loading").css({transform:"translate3d("+a+"px, "+t+"px, 0)"})}window.document.addEventListener("mousemove",a,!1)}},scrl={current:0,before:0},loopTimer;document.addEventListener("DOMContentLoaded",function(){isPage=$("body").attr("id"),common.init()});var loopthumb={init:function e(){for(var a="",t=0;t<10;t++){var i=$("#front_loop li").eq(t).clone();$("#front_loop ul").append(i)}var n=0,s=$("#front_loop li").length;loopTimer=setInterval(function(){var e;($("#front_loop li").width()+25)*s/2<=++n&&(n=0),$("#front_loop ul").css({transform:"translate3D("+-1*n+"px,0,0)"})},.033)},stop:function e(){var a=$.Deferred();return $("#front").fadeOut(600,function(){clearInterval(loopTimer),$("#front").remove(),a.resolve()}),a.promise()}},path="",posts=[],archive={current:0,max:0,count:10,loadFlag:!0,isFirst:!0,init:function e(){$(".posts").addClass("disable"),archive.current=0,archive.loadFlag=!1;var a=path+"/api/";a=search.param?a+"?"+search.param+"&page="+archive.current:a+"?page="+archive.current;var t={};load.getJson(a,t).done(function(e){archive.current=0,archive.max=Math.ceil(e.total_count/archive.count),//console.log(json)
//console.log(archive.current, "/", archive.max);
$(".posts ul.grid li").remove(),common.scrollToPosition(0),archive.makeHTML(e)}),//
$("ul.list_tag").each(function(e){var a=$(this).find("li").length;$("ul.list_tag").eq(e).find("li").eq(a-1).addClass("nobdr"),a%2==0&&$("ul.list_tag").eq(e).find("li").eq(a-2).addClass("nobdr")})},addPosts:function e(){//console.log(archive.current, archive.max);
if($("#loading").addClass("transparent"),$("#icon_loading").addClass("show"),$("#loading_logo").addClass("disable"),archive.current<=archive.max){var a=path+"/api/";a=search.param?a+"?"+search.param+"&page="+archive.current:a+"?page="+archive.current;var t={};load.getJson(a,t).done(function(e){
//	console.log(json);
archive.makeHTML(e)})}else archive.current=archive.max},makeHTML:function e(a){param.y=a.years,param.c=a.categories,param.t=a.tags;var t="",i=archive.count,n=a.posts;n.length<10&&(i=n.length);//console.log("make html")
//console.log(len)
for(var s=[],o=0;o<i;o++){var r=n[o],c="";t+=o%2==0?'<li class="cl blk">':'<li class="cr blk">';for(var l="",d="",h=0;h<r.categories.length;h++)l+="<span>"+r.categories[h]+"</span>";for(var f=0;f<r.tags.length;f++)d+="<span>"+r.tags[f]+"</span>";var u=r.permalink.replace("http://perfume-lab.local/","/");if(r.eye_catch){var m=r.eye_catch,g=r.eye_catch_m;isSP?s.push(g):s.push(m),c='<figure><img src="'+m+'" srcset="'+g+" 640w,"+m+' 1280w" sizes="(min-width: 640px) 50vw, 100vw" alt="'+r.title+'"></figure>'}else;t+='<a href="'+u+'" title="'+r.title+'" data-id="'+r.id+'"><div class="bdr"></div><div class="ttl"><h3>'+r.title+'</h3><p class="date">'+r.date+'</p><div class="info"><dl><dt>Category</dt><dd>'+l+"</dd></dl><dl><dt>Tag</dt><dd>"+d+"</dd></dl></div></div>"+c+"</a></li>"}$(".posts ul.grid").append(t),//console.log(imgArry);
archive.checkNav(),0===s.length?archive.afterAddPosts():
//console.log(imgArry)
preload.startLoad(s.length,s).done(function(){archive.afterAddPosts()})},afterAddPosts:function e(){page.nav(),//console.log("after add posts")
setTimeout(function(){function a(e){var a=$(".posts ul.grid li").eq(e);a.addClass("animate"),setTimeout(function(){a.addClass("animated")},1e3)}archive.loadFlag=!0,grid.checkHeight(),archive.nav(),//console.log(page.first)
page.first?(page.first=!1,archive.isFirst=!1,//return false
loopthumb.stop().done(function(){randomText.init(),$("#nav_category .col").removeClass("disable"),setTimeout(function(){$(".r").each(function(e){rands[e].run(e)})},600),$("#loading").removeClass("transparent"),$(".posts").removeClass("disable"),$html.classList.remove("intro"),a(0),a(1)})):setTimeout(function(){var e;//	console.log(len);
0<$("#select_categories ul li a.active").length&&isSmallScreen&&page.removeLoading(),isSmallScreen&&$("body").hasClass("show_loading")&&page.removeLoading(),isSmallScreen||page.removeLoading(),$(".posts").removeClass("disable"),a(0),a(1)},400)},100)},inc:function e(){archive.current++,archive.current>=archive.max?(archive.current=archive.max-1,archive.loadFlag=!0,console.log("inc"),page.removeLoading()):(page.showLoading(),archive.addPosts())},nav:function e(){function s(a,e,t,i){a.hasClass("active")?(
//console.log(cat, name)
$("[data-name="+t+"]").each(function(e){$("[data-name="+t+"]").eq(e).removeClass("active")}),archive.removeParam(e,t,i)):("year"===e&&$(".list_year li a").removeClass("active"),$("[data-name="+t+"]").each(function(e){a.addClass("active")}),archive.addParam(e,t,i))}function a(){$("body").removeClass("show_menu"),search.changeURL()}var t=$("body");$("#nav_category a[data-name]").off().on("click",function(){var e=$(this);if(e.hasClass("disable"))return!1;if(archive.loadFlag){archive.loadFlag=!1;var a=e.attr("data-id"),t=e.attr("data-name"),i;s(e,e.attr("data-cat"),t,"pc")}}),$("#header h1 a").off().on("click",function(){function e(){var e,a="easeInOutCubic",t=!0;$("html,body").animate({scrollTop:"0px"},{duration:10})}t.hasClass("detail")?(
//下層にいるとき
search.changeURL(),//var path = "/";
page.checkUrl(),setTimeout(function(){e()},650)):e()}),$("#block_spnav a[data-name]").off().on("click",function(){var e=$(this);if(archive.loadFlag){if(archive.loadFlag=!1,e.hasClass("disable"))return!1;var a=e.attr("data-id"),t=e.attr("data-name"),i;s(e,e.attr("data-cat"),t,"sp")}}),$("#post_detail nav.nav a[data-name]").off().on("click",function(){var e=$(this);if(archive.loadFlag){if(archive.loadFlag=!1,e.hasClass("disable"))return!1;var a=e.attr("data-id"),t=e.attr("data-name"),i=e.attr("data-cat");if(isSmallScreen)var n="sp";else var n="pc";s(e,i,t,n)}}),$("a#btn_ok").off().on("click",function(){a()}),$("a#btn_ok_detail").off().on("click",function(){a()})},addParam:function e(a,t,i){
//console.log(cat,param,device)
"year"===a?(search.y=[],search.y.push(t)):"cat"===a?search.cat.push(t):"tag"===a&&search.tag.push(t),search.makeArryUnique(),search.changeURL()},removeParam:function e(a,t,i){
//console.log(cat,param,device)
"year"===a?search.y=[]:"cat"===a?search.cat.forEach(function(e,a){e===t&&search.cat.splice(a,1)}):"tag"===a&&search.tag.forEach(function(e,a){e===t&&search.tag.splice(a,1)}),search.makeArryUnique(),search.changeURL()},checkNav:function e(){$.each(param.y,function(e,a){var t=param.y[e],i=t.year,n=$("[data-name="+i+"]");0===t.count?n.addClass("disable"):n.hasClass("disable")&&n.removeClass("disable")}),$.each(param.c,function(e,a){var t=param.c[e],i=t.cat_ID,n=$("[data-id=cat-"+i+"]");0===t.count?n.addClass("disable"):n.hasClass("disable")&&n.removeClass("disable")}),$.each(param.t,function(e,a){var t=param.t[e],i=t.term_id,n=$("[data-id=tag-"+i+"]");0===t.count?n.addClass("disable"):n.hasClass("disable")&&n.removeClass("disable")})}},slideTimer,slideshow={current:0,max:0,init:function e(){function a(){function a(){var e=new Image;e.src=t[i],e.onload=function(){++i<n?a():(slideshow.nav(),slideshow.change())}}a()}slideshow.current=0,slideshow.max=$(".slideshow .imgs li").length,slideshow.nav();var t=[];$(".slideshow ul.imgs li").each(function(e){if(0<$(this).find("img").length){var a=$(this).find("img").attr("src");t.push(a)}});var i=0,n=t.length;a()},nav:function e(){$(".nav_slide li a").off().on("click",function(){slideshow.current=$(".nav_slide li a").index(this),$(".nav_slide li a").removeClass("active"),$(this).addClass("active"),slideshow.change()})},inc:function e(){},dec:function e(){},change:function e(){var a,t=$(".slideshow ul.imgs li").eq(slideshow.current).find("img").height();$(".slideshow ul.imgs").css("height",t),$(".slideshow ul.imgs li").removeClass("active"),$(".slideshow ul.imgs li").eq(slideshow.current).addClass("active")}},timeline={current:0,max:0,years:[],winW:0,lineW:0,flag:!0,init:function e(){var a=timeline;a.current=0,a.max=$("#block_timeline .year").length,d.init(),this.nav();var t=0},nav:function e(){$("#timeline_prev").off().on("click",function(){timeline.flag&&(timeline.flag=!1,timeline.dec())}),$("#timeline_next").off().on("click",function(){timeline.flag&&(timeline.flag=!1,timeline.inc())})},dec:function e(){timeline.change("left")},inc:function e(){timeline.change("right")},change:function e(a){var t=$("#block_timeline .timeline_wrap"),i=Math.floor($(window).width()/d.totalW*100);if("left"===a)var n=d.barLeft-i;else var n=d.barLeft+i;d.barLeft=n,$("#block_timeline").addClass("transition"),d.barLeft>100-d.targetW?d.barLeft=100-d.targetW:d.barLeft<0&&(d.barLeft=0),d.scrl(),//バーも動かす
setTimeout(function(){$("#block_timeline").removeClass("transition"),timeline.flag=!0},600)},checkPos:function e(){var a="."+$(".content").attr("data-id"),t=$("#block_timeline").find(a);//console.log($block.parent().parent().position().left, $block.position().left)
if(isSmallScreen){var i=$(".timeline_inner").scrollLeft()+t.offset().left,n="easeInOutCubic";$(".timeline_inner").animate({scrollLeft:i+"px"},{duration:1e3,easing:n})}else{var i=t.parent().parent().position().left+t.position().left;d.scrollLeftpx=i,$("#block_timeline li").removeClass("active"),$("#block_timeline").addClass("transition"),$(a).addClass("active"),d.barLeft=d.scrollLeftpx/d.totalW*100,d.barLeft>100-d.targetW?d.barLeft=100-d.targetW:d.barLeft<0&&(d.barLeft=0),d.scrl(),setTimeout(function(){$("#block_timeline").removeClass("transition")},600)}}},Grid={top:0,h:0},grids=[],gh={l:0,r:0},grid={mb:60,init:function e(){grid.checkHeight()},checkHeight:function e(){if(grids=[],gh.l=0,gh.r=0,isSmallScreen)$(".posts .grid li").each(function(e){$(this).css({top:""})}),$(".posts_inner").css({height:""});else{$(".posts .grid li").each(function(e){var a=object(Grid);a.h=$(this).outerHeight(),e%2?($(this).css({top:gh.r+"px"}),gh.r+=a.h+grid.mb):($(this).css({top:gh.l+"px"}),gh.l+=a.h+grid.mb)});var a=Math.max(gh.l,gh.r);$(".posts_inner").css({height:a+"px"})}common.checkBlock()}},YearPos={leftPer:0,leftPx:0,leftMax:0},years=[],d={target:"",targetLeft:0,totalW:0,startX:0,mx:0,barLeft:0,barMax:0,scrollLeft:0,scrollLeftpx:0,targetW:0,yearPos:[],isDown:!1,init:function e(a){d.target=$("#current_timeline")[0],d.target.addEventListener("mousedown",d.mdown,!1),document.addEventListener("mouseup",d.mup,!1),
/*$("#bar_timeline").on("mouseleave", function(){
    	d.mup();
    });*/
$(document).off("mousemove").on("mousemove",function(e){d.isDown&&d.mmove(e)}),d.resize(),setTimeout(function(){d.resize()},600)},resize:function e(){d.yearPos=[];var s=0,o=0,r=$(".year ul li").outerWidth();$(".year").each(function(e){var a=0,t=$(this).find("ul li").length;$("ul li",this).each(function(e){a=r*e,$(this).css({left:a+"px"})});var i=r*t;$(this).css({width:i+"px",left:s+"px"});var n=s;s+=i,o+=a+r}),d.totalW=o+30,$(".timeline_wrap").css({width:d.totalW+"px"}),//年ごとに位置を測定
years=[],$(".year").each(function(e){var a=object(YearPos);a.leftPx=$(this).position().left,a.leftPer=a.leftPx/o*100,a.leftMax=$(this).width()-$(this).find("h5").width()-30,years.push(a)}),//タイムラインのUIの大きさ算出
timeline.winW=$(window).width();var a=timeline.winW/o,t=Math.floor(100*a);d.targetW=t,$("#current_timeline").css("width",t+"%"),d.mx=Math.floor(timeline.winW-timeline.winW*a),setTimeout(function(){timeline.checkPos()},300)},mdown:function e(a){d.isDown=!0,//console.log(d.startX, d.targetLeft);
d.targetLeft=d.target.offsetLeft;var t=d.targetLeft;d.startX=a.clientX-t,//console.log("start:",e.clientX, offset, d.startX);
$("#bar_timeline").off("mouseup").on("mouseup",function(e){d.mup()})},mmove:function e(a){console.log(d.isDown);//e.preventDefault();
var t=a.clientX-d.startX;d.barLeft=t/$("#bar_timeline").width()*100,//d.barLeft = l/d.mx*100;
//console.log("offset:",d.targetLeft, "差分:", diff, d.mx,"結果:", d.barLeft);
d.barLeft>100-d.targetW?d.barLeft=100-d.targetW:d.barLeft<0&&(d.barLeft=0),d.target.addEventListener("mouseup",d.mup,!1),//d.target.addEventListener("mouseleave", d.mup, false);
d.scrl()},mup:function e(a){d.isDown=!1,//document.body.removeEventListener("mousemove", d.mmove, false);
//console.log(d.target.style.left,"up-------------------------")
//d.startX = 0;
$("#bar_timeline").off(),d.target.removeEventListener("mouseup",d.mup,!1),//d.target.removeEventListener("mouseleave", d.mup, false);
$(document).off("mousemove").on("mousemove",function(e){d.isDown&&d.mmove(e)})},scrl:function e(){if(isSmallScreen);else{var a=function e(a){var t=$(".year").eq(a);t.hasClass("active")||($(".year").removeClass("active"),t.addClass("active"))},t=d.barLeft;d.scrollLeft=-t,d.scrollLeftpx=d.totalW*(t/100);//console.log(per,d.scrollLeft, years)
for(var i=years.length,n=0;n<i;n++)n===i-1?t>=years[n].leftPer&&(timeline.current=n):t>=years[n].leftPer&&t<years[n+1].leftPer&&a(timeline.current=n);$(".year").each(function(e){var a=d.scrollLeftpx-years[e].leftPx,t=years[e].leftMax;t<=a&&(a=t),a<0&&(a=0),$(this).find("h5").css({transform:"translate3d("+a+"px ,0,0)"})}),//console.log("scrl:　offset:",d.targetLeft, "スタート位置:",d.startX, "結果:", d.barLeft);
d.moveBar()}},moveBar:function e(){
//console.log(d.barLeft, d.target.offsetLeft);
$("#current_timeline").css({left:d.barLeft+"%"}),$(".timeline_wrap").css({transform:"translate3d("+d.scrollLeft+"% ,0,0)"}),d.targetLeft=d.target.offsetLeft}},page={current:"",id:"",clickFlag:!0,first:!0,loadID:0,init:function e(){page.nav(),grid.init(),page.checkUrl(),window.addEventListener("popstate",function(e){page.checkUrl()})},showLoading:function e(){if(archive.isFirst)return archive.isFirst=!1;var a,t="p"+[0,1,2,3,4][Math.floor(4*Math.random())];$("#icon_loading").removeClass(),$("#icon_loading").addClass(t);var i=$("body");i.hasClass("load")||(i.addClass("load"),i.addClass("open"),setTimeout(function(){i.addClass("show_loading")},50))},removeLoading:function e(){var a=$("body");a.removeClass("open"),a.addClass("close"),a.removeClass("show_category"),a.hasClass("load")?(a.removeClass("show_loading"),setTimeout(function(){a.removeClass("load"),setTimeout(function(){a.removeClass("close"),$("#loading").removeClass("transparent"),$("#loading_logo").removeClass("disable"),$("#icon_loading").removeClass("show")},600)},600)):setTimeout(function(){a.removeClass("close")},600)},nav:function e(){function n(){if(page.clickFlag){page.clickFlag=!1;var e=s.attr("href");page.changeURL(e)}}function t(){search.changeURL()}function a(){$("#btn_close_about").off().on("click",function(){o.hasClass("show_about")&&(o.removeClass("show_about"),setTimeout(function(){o.removeClass("about")},400))})}//share
function i(e,a){var t=location.href,i="";if(0===e)i="facebook",//Facebook
window.open("http://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(t),"facebooksharedialog","width=626,height=436");else if(1===e){i="twitter";//Twitter
var n=s.attr("data-text");window.open("http://twitter.com/share?url="+encodeURIComponent(t)+"&amp;text="+encodeURIComponent(n),"twittersharedialog","width=626,height=436")}gtag("event","share",{event_category:i,event_label:location.pathname})}var s,o=$("body"),s;$("section.posts a").off("click").on("click",function(e){e.preventDefault(),page.loadID=$(this).attr("data-id"),s=$(this),n()}),$("#block_timeline li a").not(".btn").off("click").on("click",function(e){e.preventDefault(),page.loadID=$(this).attr("data-id"),s=$(this);var a,t="easeInOutCubic",i=!0;$("#post_detail .detail_inner").animate({scrollTop:"0px"},{duration:600,easing:t,complete:function e(){n()}})}),$("#btn_close_detail").off().on("click",function(e){e.preventDefault();var a=$(this).attr("href");t()}),$(".detail_header h2 a").off().on("click",function(e){e.preventDefault();var a=$(this).attr("href");t()}),$(".nav_about a").off().on("click",function(){o.hasClass("show_about")||(o.addClass("about"),setTimeout(function(){o.addClass("show_about"),a()},300))}),$(".share li a").off().on("click",function(){var e,a;s=$(this),i($(".share li a").index(this),$(this).attr("data-share"))})},changeURL:function e(a){page.current=a,window.history.pushState(null,null,a),page.checkUrl()},afterLoadPage:function e(){var a=$("body"),t=$("#post_detail");page.nav(),//page.clickFlag = true;
archive.clickFlag=!0,a.hasClass("detail")&&slideshow.init(),isSmallScreen||timeline.init(),//console.log("here")
$("article").css("height",""),a.hasClass("detail")&&t.removeClass("disable"),archive.nav(),setTimeout(function(){timeline.checkPos(),a.hasClass("detail")&&page.removeLoading(),page.clickFlag=!0},1200)},changePage:function e(){for(var i=$("body"),a=$("#post_detail"),t,n=posts.filter(function(e,a){if(e.id==page.loadID)return!0})[0],s=[],o=[],r=0//console.log(page.directory)
;r<n.categories.length;r++)s+="<span>"+n.categories[r]+"</span>";for(var c=0;c<n.tags.length;c++)o+="<span>"+n.tags[c]+"</span>";$("#post_header h3").html(n.title),$("#post_header p.date").html(n.date),$("#post_header dl:eq(0) dd").html(s),$("#post_header dl:eq(1) dd").html(o),page.showLoading(),$.get(page.directory,{},function(e){var a=$(e),t=$("header",a)[0];//console.log(data)
page.changeContent(e).done(function(){if(i.hasClass("detail"))page.afterLoadPage();else{i.addClass("detail");var e,a="easeInOutCubic",t=!0;$(".detail_inner").animate({scrollTop:"0px"},{duration:100,easing:a,complete:function e(){setTimeout(function(){i.addClass("show_detail"),page.afterLoadPage()},600)}})}})})},changeContent:function e(a){var t=$.Deferred(),i=$(a),n=i.filter("title")[0].innerHTML,s=$("#post_detail .article_inner"),o=$(".content",i)[0],r=$("header",i)[0],c=$(".content").outerHeight();//$("#loading_logo #post_header").html(postTitle);
$("article").css("height",c+"px"),setTimeout(function(){document.title=n,s.html(o)},50);var l=[];return $("#post_detail img").each(function(){l.push($(this).attr("src"))}),0<l?preload.startLoad(l.length,l).done(function(){setTimeout(function(){t.resolve()},50)}):setTimeout(function(){t.resolve()},50),t.promise()},closeDetailPage:function e(){var a=$("body");a.removeClass("show_detail"),setTimeout(function(){a.removeClass("detail");var e=$("header#header h1 a").attr("title");document.title=e,page.afterLoadPage(),common.resize()},100)},checkUrl:function e(){var a=$("body"),t=$("#post_detail"),i=location.pathname,n,s=(page.current=i).split("/").length,o=new Object,r=location.search.substring(1);search.param=r;var c=2;//console.log(currentLang, langLen)
if("en"===currentLang&&(c=3),gtag("event","pageview",{event_category:"pageview",event_label:location.pathname}),s===c){if(""!=r){for(var l=r.split("&"),d=0;l[d];d++){var h=l[d].split("=");//console.log(kv[0])
"y"===h[0]?search.y.push(h[1]):"c[]"===h[0]?search.cat.push(h[1]):"t[]"===h[0]&&search.tag.push(h[1])}$("#loading").addClass("transparent"),$("#icon_loading").addClass("show"),$("#loading_logo").addClass("disable"),page.showLoading(),search.makeArryUnique(),search.checkActive(),archive.init()}else page.first?archive.init():
//ソートのボタンをクリックするとflagがfalseになるので、詳細ページから戻ってきた場合と場合わけ
archive.loadFlag||(archive.loadFlag=!0,search.checkActive(),archive.init());//TOP
page.closeDetailPage()}else
//console.log("here")
//下層ページ
page.directory=location.pathname,a.hasClass("detail")?page.first?(archive.init(),page.afterLoadPage()):(t.addClass("disable"),setTimeout(function(){page.changePage()},400)):page.changePage()}};
//# sourceMappingURL=main-min.js.map
//# sourceMappingURL=main-min.js.map